запросить у пользователя путь к сервисному каталогу, в котором будут провеодится работы
<task>
Создание перевода мода в игре World of Tanks.
</task>
<context>
ОСОБЕННОСТИ ВЫПОЛНЕНИЯ:
- Работу начинай только если уже существуют файлы ru.json и en.json.
- Сервисные файлы:
  - 1dictionary.json — единый словарь терминов.
  - 1log.md — рабочий лог (создай, если отсутствует).
  - 1REPORT.md — финальный отчёт.
- Перед началом проверь окружение: выполни `python --version` (должно быть 2.7.18) и `Get-Culture` (ожидается ru-RU). При отсутствии нужной версии Python запроси у пользователя инструкцию, не продолжай без подтверждения.
- Активируй виртуальное окружение/интерпретатор Python 2.7.18, если требуется, и добавь в лог строку вида `Python: C:\Python27\python.exe` или путь к venv.
- После завершения каждого этапа сообщи пользователю его статус (выполнено/пропущено/требует действий) и перечисли ключевые шаги.
- Если вспомогательные языковые файлы отсутствуют, создай их с заполнителем `"TODO_TRANSLATE_<LANG>"`.
- Исходный код мода расположен в файлах формата *.py и должен оставаться совместимым с Python 2.7.
- Скрипты для проверки запускай в среде Python 2.7.18; учитывай русскую локаль PowerShell (вывод команд на русском).
Лог-файл: 1log.md
Отчёт: 1REPORT.md
</context>
<logging>
Формат файла 1log.md:
- Заголовок `# Отчёт выполнения перевода`.
- Для каждого этапа блок вида:
  ## Этап N — Краткое название
  - Статус: <выполнено|пропущено|требуется действие>
  - Дата/время: YYYY-MM-DD HH:mm UTC
  - Действия: перечисление предпринятых шагов
  - Наблюдения: найденные проблемы или подтверждение корректности
  - Предупреждение: добавляй только при наличии ошибок или рисков
- После сбора источников по ключам фиксируй, какие записи отправлены пользователю на подтверждение, и итоговый ответ.
- Для системных сведений (окружение, тайм-ауты, отсутствие инструментов) используй лаконичные строки, например `Python: C:\Python27\python.exe`, `rg: недоступен, использован Select-String`.
Файл веди на русском, без художественных вставок, но в «human-like» стиле.

Структура файла 1REPORT.md:
- Заголовок `# Итоговый отчёт`.
- Краткий вводный абзац о ходе работ (укажи дату/время UTC последнего обновления).
- Секции: `## Выполненные задачи`, `## Проблемы и риски`, `## Рекомендации`.
- В каждой секции перечисляй пункты, используйте относительные пути к файлам.
- Если раздел пуст, напиши `Нет`.
</logging>
<stages>
Этап 1: Проверь наличие файла списка языков "D:\github.com\spoter-mods\.github\LANG_LIST.md" и обязательных файлов ru.json и en.json. Создай 1log.md, если он отсутствует. Если любой из обязательных файлов отсутствует или повреждён, зафиксируй статус «требуется действие», предупреди пользователя и останови процесс до получения корректных файлов.
Ожидаемый результат "Этап 1": найдены LANG_LIST.md, ru.json, en.json в рабочем состоянии и создан базовый 1log.md.

Этап 2: Для каждого языка из LANG_LIST.md, кроме ru и en, проверь наличие соответствующего файла *.json. Если файла нет, создай копию ru.json, сохрани структуру ключей и замени все значения на строку `"TODO_TRANSLATE_<код языка из файла>"`. Обеспечь кодировку UTF-8-BOM и минимальное форматирование с двумя пробелами на уровень вложенности. Если создание файла не удалось, зафиксируй это в логе и продолжи со следующими языками. При обнаружении повреждений в ru.json или en.json немедленно останови этап и вернись к Этапу 1.
Ожидаемый результат "Этап 2": полный набор json-файлов по списку языков (новые файлы содержат корректный JSON и заполнители `TODO_TRANSLATE_<LANG>`), в логе отражены пропуски и ошибки.

Этап 3: Для каждого ключа из ru.json собери расширенный контекст и словарную запись в `1dictionary.json` (создай файл, если его нет). Действия:
- Найди все появления ключа в исходных *.py-файлах мода, выпиши примеры строк и окружающий код (на 3–5 строк выше и ниже) для понимания сценария применения.
- Определи тип сообщения (UI, ошибка, подсказка и т.п.) и добавь краткое описание сценария в поле `context`.
- Изучи официальные источники World of Tanks (порталы Wargaming, документация игры, патч-ноды) и проверенные комьюнити-ресурсы. Сохраняй ссылки или упоминания источников в `sources`, записывай цитаты/термины, на которые опираешься.
- Для каждого языка из LANG_LIST.md подбери устоявшиеся формулировки: сначала официальные переводы, затем жаргон, используемый игроками в интернете. Если на языке нет устойчивого аналога, оставь `TODO_TRANSLATE_<LANG>`.
- Подготовь блок “Предложение пользователю”: в ответе ассистента сформируй Markdown-блок вида:
  ```
  ### Ключ: <ключ>
  - Контекст: <краткое описание>
  - Предлагаемые переводы: <язык – значение>
  - Источники: <перечень ссылок/описаний>
  - Статус: pending-user-review
  ```
  После отправки дождись ответа пользователя, зафиксируй его решение в 1log.md и обнови статус записи в 1dictionary.json.
- Если пользователь не отвечает в течение 24 часов (или до конца текущей сессии), отметь ключ статусом "pending-user-review", зафиксируй в логе строку `Ответ пользователя: ожидание` и продолжай. Вернись к ключу после получения ответа.

Формат записи на ключ:
{
  "ключ": {
    "context": "описание сценария использования",
    "references": ["файл.py:строка", ...],
    "translations": {
      "ru": "значение",
      "en": "перевод",
      "<прочие языки>": "устойчивый вариант или TODO"
    },
    "status": "pending-user-review" | "verified" | "requires-verification",
    "sources": ["URL или описание источника", ...]
  }
}
Ожидаемый результат "Этап 3": 1dictionary.json содержит полный контекст, источники, перевод по всем языкам или TODO, а также статусы пользовательской проверки по каждому ключу, соответствующие ответам пользователя либо помеченные как ожидающие.

Этап 4: Синхронизируй переводы всех json-файлов по списку языков. Действуй в порядке, указанном в LANG_LIST.md, переходя от ru/en к остальным языкам.
- Для каждого файла проверь, что набор ключей совпадает с ru.json. Отсутствующие ключи добавь с `TODO_TRANSLATE_<LANG>`, лишние перенеси в конец файла и пометь как `UNUSED_KEY_<оригинал>` с записью в лог.
- Применяй переводы из 1dictionary.json: значения со статусом "verified" переносишь напрямую; статусы "pending-user-review" оставляй как `TODO_TRANSLATE_<LANG>` с комментарием в логе и пометкой ключа для повторного согласования; статусы "requires-verification" не переводишь до получения обновлённого словаря.
- Если при проверке обнаружишь новый термин или уточнение, сначала обнови 1dictionary.json (статус "pending-user-review"), сообщи пользователю (используй формат из Этапа 3) и дождись решения, только затем возвращайся к соответствующим языковым файлам.
- По завершении работы с файлом добавь в 1log.md блок о проделанных шагах (какие ключи обновлены, какие ждут подтверждения, какие помечены как UNUSED).
- После полного прохода по списку языков отправь пользователю сводку нерешённых ключей в формате списка `ключ – статус – комментарий`. До получения ответа оставь ключи в статусе "pending-user-review". После ответа обнови 1dictionary.json и 1log.md.
- Если пользователь не ответил в течение 24 часов, зафиксируй в логе `Сводка отправлена: ожидание ответа`, переходи к Этапу 5, а нерешённые ключи перечисли в отчёте.

Ожидаемый результат "Этап 4":
- Все языковые файлы синхронизированы по набору ключей с ru.json.
- Подтверждённые переводы перенесены, спорные отмечены и задокументированы.
- 1dictionary.json содержит актуальные статусы и, при необходимости, новые записи.
- Пользователю отправлена сводка нерешённых ключей, статусы обновлены по полученным ответам или отмечены как ожидающие.

Этап 5: Проверь целостность файлов переводов и словаря. Действия выполняй в PowerShell с учётом русской локали (сообщения команд могут быть на русском) и в среде Python 2.7.18.
- Валидация JSON: для каждого *.json запусти `python -m json.tool путь\файл.json > $null` (Python 2.7.18). Если Python недоступен, запроси у пользователя установку или альтернативу (например, готовый скрипт). Ошибки синтаксиса фиксируй в логе с текстом исключения.
- Проверка кодировки: используй `Get-Content -Encoding Byte` и убедись, что файл начинается с BOM `EF BB BF`. Для добавления BOM используй `Set-Content -Encoding utf8BOM` (PowerShell 7+) или Python-скрипт, который записывает BOM вручную; зафиксируй выбранный способ в логе.
- Контроль наборов ключей: сравни ключи каждого языка с ru.json. Используй `Compare-Object` или `python -c` скрипт (2.7.18) для автоматизации. Лишние/отсутствующие элементы занеси в лог, согласуй дальнейшие действия с пользователем (удаление, TODO, перенос).
- Поиск использования ключей в коде: выполни `rg --pcre2 'localize\("(?P<key>[^"]+)"' *.py`. Если `rg` отсутствует, используй `Select-String -Pattern 'localize\("([^"]+)"' -Path *.py`. При отличающихся функциях локализации опиши подход в логе. Ключи из JSON, не найденные в коде, вынеси в отдельный список для согласования.
- Автоматизированный отчёт: при необходимости создай короткий PowerShell/Python-скрипт (совместимый с Python 2.7.18), который проходит по всем JSON-файлам и агрегирует ошибки. Укажи имя скрипта и результат его запуска в логе.
- Сопоставь блоки локализации внутри исходных *.py (например, `self.i18n`, `config.i18n`) с актуальным en.json: с помощью Python 2.7.18 выгрузи пары ключ/значение, сравни наборы и строки с en.json, исправь расхождения и опиши изменения (файл, ключ, команда) в 1log.md.

Ожидаемый результат "Этап 5":
- Все файлы подтвердили валидность JSON и корректную кодировку UTF-8-BOM.
- Выявленные несоответствия ключей задокументированы и вынесены на согласование или исправлены.
- Блоки локализации в исходных *.py синхронизированы с en.json, применённые корректировки отражены в логе.
- 1log.md содержит перечень проверенных файлов, используемые команды, вывод ошибок (если были) и статус каждого шага.
Этап 6: Подготовь итоговый пакет документов.
- Обнови 1REPORT.md согласно структуре: краткий вводный абзац с датой/временем (UTC) последнего обновления; раздел `## Выполненные задачи` со списком действий и ссылками на файлы (`ru.json`, `1dictionary.json` и т.д.); `## Проблемы и риски` с перечислением ключей в статусах "pending-user-review" и "requires-verification" (укажи комментарии и источники); `## Рекомендации` с конкретными шагами для пользователя.
- Добавь таблицу/список "Итог по ключам" (шаблон):
  | Ключ | Статус | Комментарий | Источники/файл |
  | --- | --- | --- | --- |
  | example.key | pending-user-review | Ожидается ответ пользователя от 2025-09-20 | 1dictionary.json |
  | example2.key | verified | Перевод подтверждён пользователем | 1dictionary.json |
  При отсутствии нерешённых ключей напиши: "Все ключи подтверждены".
- Укажи в отчёте UTC-время последнего обновления 1dictionary.json и 1log.md (возьми из файлов или метаданных).
- Перед сохранением сверяй, что перечисленные статусы совпадают с актуальными данными в 1dictionary.json и 1log.md, и зафиксируй факт проверки в логе (Этап 6).
- Убедись, что 1REPORT.md сохранён в UTF-8-BOM; при необходимости используй `Set-Content -Encoding utf8BOM` или Python-скрипт с записанным BOM и запиши действие в лог.
- Заверши Этап 6 записью в 1log.md: резюме выполненных пунктов, список переданных пользователю файлов, оставшиеся вопросы. Если пользователь должен подтвердить нерешённые ключи, напомни об этом в отчёте и логе.

Ожидаемый результат "Этап 6":
- 1REPORT.md содержит структурированный отчёт с датами, ссылками на файлы, таблицей статусов ключей и рекомендациями.
- 1dictionary.json и 1log.md синхронизированы со сведениями из отчёта (статусы подтверждены и актуальны).
- В 1log.md добавлена финальная запись по Этапу 6 с подтверждением проверки, ссылкой на отчёт и списком переданных файлов.
</stages>
