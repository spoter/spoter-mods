# План выполнения локализации мода World of Tanks (GPT-5 Codex High, RU)
запросить у пользователя путь к сервисному каталогу, в котором будут провеодится работы
## 0. Область работ
- Цель: подготовить полный, проверенный перевод мода на все языки из spoter-mods\.github\LANG_LIST.md.
- Сервисные артефакты: 1dictionary.json, 1log.md, 1REPORT.md.

## 1. Предусловия (при несоблюдении остановиться)
1. Файлы "ru.json" и "en.json" существуют и содержат валидный JSON.
2. Python 2.7.18 доступен (проверить python --version). При иной версии — остановиться и запросить инструкцию у пользователя.
3. Культура PowerShell равна "ru-RU" (Get-Culture). При расхождении — согласовать с пользователем.
4. Активировать нужный интерпретатор/venv и зафиксировать путь в логе (пример: Python: C:\\Python27\\python.exe).
5. Создать 1log.md, если отсутствует.

## 2. Правила логирования (1log.md)
- Один раз указать заголовок # Отчёт выполнения перевода.
- Для каждого этапа добавлять блок:
  - ## Этап N — <название>
  - - Статус: выполнено|пропущено|требуется действие
  - - Дата/время: YYYY-MM-DD HH:mm UTC
  - - Действия: ...
  - - Наблюдения: ...
  - - Предупреждение: ... (только при необходимости)
- Системные сведения фиксировать кратко (пример: Python: C:\\Python27\\python.exe, \rg: недоступен, использован Select-String).
- Фиксировать автоматические преобразования: какие скрипты или алгоритмы применялись, какие языки получили итоговые тексты, где остались автопереводы.

## 3. Правила отчёта (1REPORT.md)
1. Заголовок # Итоговый отчёт и вводное предложение с отметкой времени (UTC).
2. Раздел ## Выполненные задачи — маркированный список с относительными путями.
3. Раздел ## Проблемы и риски — нерешённые вопросы (Нет, если пусто).
4. Раздел ## Рекомендации — конкретные дальнейшие шаги (Нет, если пусто).
5. Таблица «Итог по ключам» (Markdown):
   | Ключ | Статус | Комментарий | Источники/файл |
   | --- | --- | --- | --- |
   | example.key | auto-translated | Перевод применён автоматически | 1dictionary.json |
   | example2.key | requires-update | Нужны уточнения терминов | 1dictionary.json |
   Если все ключи успешно заполнены и не требуют уточнений — заменить таблицу строкой «Все ключи актуализированы автоматически.»
6. Указать UTC-время последнего обновления для 1dictionary.json и 1log.md.
7. Сохранить файл в UTF-8 с BOM и упомянуть об этом в логе.

## 4. Этапы (всегда придерживаться схемы «Входы → Действия → Выходы»)

### Этап 1 — Базовая проверка
- Входы: LANG_LIST.md, ru.json, en.json.
- Действия:
  1. Проверить наличие и валидность JSON файлов.
  2. Создать 1log.md, если он отсутствует (добавить заголовок).
  3. Занести в лог информацию об окружении (Python, культура).
- Выходы: обязательные файлы подтверждены, лог инициализирован. При проблемах — статус «требуется действие», уведомление пользователя, останов.

### Этап 2 — Инвентаризация языковых файлов
- Входы: результаты Этапа 1, LANG_LIST.md.
- Действия:
  1. Для каждого языка, кроме ru/en, убедиться в наличии <lang>.json.
  2. При отсутствии — клонировать ru.json, оставить набор ключей, заменить значения на «TODO_TRANSLATE_<LANG>».
  3. Сохранить файл в UTF-8 BOM с двухпробельным отступом.
  4. Отразить в логе созданные/пропущенные файлы и ошибки.
- Выходы: полный набор JSON по списку языков, placeholders где нужно, лог обновлён.

### Этап 3 — Формирование словаря и авто-перевод
- Входы: результаты Этапа 2, все языковые JSON, исходные *.py.
- Действия для каждого ключа из ru.json:
  1. Собрать контекст в коде (±3–5 строк), занести в `context` и `references`.
  2. Исследовать терминологию по официальным источникам WoT и проверенным ресурсам сообщества; ссылки/заметки внести в `sources`.
  3. Заполнить `translations` для всех языков. Если готового перевода нет, выполнить автоматический перевод (копия из en/ru, машинный перевод или согласованный алгоритм) с учётом особенностей мода. Для перевода учитывать контекст, устойчивые выражения, терминологию и особенности для игры Word of Tanks.
  4. Записать в 1dictionary.json запись со статусом `auto-translated` (для готовых текстов) или `requires-update` (если остался TODO/сомнение).
  5. Зафиксировать в логе применённые инструменты (скрипты, сервисы).
- Выходы: 1dictionary.json содержит контекст, переводы, источники и статусы без ожидания подтверждения.

### Этап 4 — Синхронизация языковых файлов
- Входы: актуальный 1dictionary.json, все языковые JSON.
- Действия:
  1. Обрабатывать языки в порядке LANG_LIST.md.
  2. Привести набор ключей к ru.json: добавлять отсутствующие с актуальными значениями, лишние переносить в конец как `UNUSED_KEY_<original>` (логировать).
  3. Применять переводы: `auto-translated` → записать значение; Проверять текущее значение при наличии и ожидаемый перевод; Синхронизировать с учётом контекста.
  4. При появлении новых терминов обновить словарь, повторить цикл Этапа 3.
  5. После каждого файла занести в лог итоги (переведено автоматически, осталось TODO, UNUSED).
- Выходы: языковые файлы синхронизированы с 1dictionary.json; в логе перечислены ключи, где остались placeholders.

### Этап 5 — Проверка целостности и использования
- Входы: обновлённые языковые файлы, 1dictionary.json, исходные *.py.
- Действия:
  1. Проверка JSON: python -m json.tool. Нет Python — запросить установку/альтернативу, ошибки записать.
  2. Проверка кодировки: Get-Content -Encoding Byte; при отсутствии BOM применить Set-Content -Encoding utf8BOM или Python-скрипт, зафиксировать метод.
  3. Сравнение ключей с ru.json: Compare-Object или Python-скрипт, занести расхождения и решения.
  4. Поиск использования в коде: \rg --pcre2 'localize\("(?P<key>[^"]+)"' *.py; при отсутствии rg — Select-String. Описать альтернативные паттерны в логе.
  5. Указать задействованные вспомогательные скрипты (имя, результат).
  6. Сопоставить блок self.i18n в исходных *.py с актуальным en.json; при расхождении обновить значения в коде и задокументировать шаги в логе.
- Выходы: результаты проверок отражены в логе; нерешённые вопросы перечислены отдельно.

### Этап 6 — Финализация
- Входы: обновлённые языковые файлы, 1dictionary.json, 1log.md.
- Действия:
  1. Сформировать 1REPORT.md по правилам (таблица или замена одной строкой).
  2. Указать UTC-время последнего обновления 1dictionary.json и 1log.md.
  3. Сверить статусы отчёта с фактическими данными.
  4. Сохранить отчёт в UTF-8 BOM и отметить это в логе.
  5. Добавить финальную запись в лог с перечнем переданных файлов и открытых вопросов.
  6. Указать, что пользователь при изменении 1dictionary.json может инициировать повторный запуск локализации для обновления перевода.
- Выходы: 1REPORT.md согласован с 1dictionary.json и 1log.md; финальный лог содержит ссылку на отчёт, список артефактов и замечания по доработке.

## 5. Правила коммуникации
- Все сообщения пользователю — на русском языке, кратко, с относительными путями.
- При нехватке инструментов/предусловий — остановиться, зафиксировать проблему в логе и дождаться указаний.

## 6. Тайм-ауты и эскалация
- Окно ожидания ответа не требуется: локализация завершается автоматически по текущим данным.
- Не изменять ru.json/en.json сверх синхронизации без явного разрешения пользователя.

## 7. Чек-лист завершения
- [ ] В логе отмечены статусы этапов 1–6 с временными метками.
- [ ] 1dictionary.json содержит контекст, ссылки, переводы и статусы `auto-translated`/`requires-update`.
- [ ] Все JSON-файлы валидны, в UTF-8 BOM и с согласованными ключами.
- [ ] 1REPORT.md заполнен по структуре, таблица/замена присутствует.
- [ ] Нерешённые вопросы (если есть) явно перечислены для пользователя.
- [ ] Финальное сообщение пользователю отправлено с итогами, указанием возможностей повторного запуска.
